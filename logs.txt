2025-08-08 22:49:46,098 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-08 22:49:46,447 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 401.7ms
2025-08-08 22:49:46,447 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:46,822 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 261.3ms
2025-08-08 22:49:46,822 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:47,176 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 256.0ms
2025-08-08 22:49:47,176 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:47,191 - app.main - WARNING - HTTPException Email already registered on /api/v1/auth/signup
2025-08-08 22:49:47,191 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 400 • 14.4ms
2025-08-08 22:49:47,191 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2025-08-08 22:49:47,288 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 1.1ms
2025-08-08 22:49:47,288 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-08 22:49:47,352 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 0.9ms
2025-08-08 22:49:47,353 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-08 22:49:47,414 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 0.7ms
2025-08-08 22:49:47,414 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-08 22:49:47,738 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 263.1ms
2025-08-08 22:49:47,738 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:47,970 - app.main - INFO - POST /api/v1/auth/login • ip=127.0.0.1 • device_id=- • 200 • 231.6ms
2025-08-08 22:49:47,970 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 200 OK"
2025-08-08 22:49:48,313 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 253.0ms
2025-08-08 22:49:48,314 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:48,542 - app.main - WARNING - HTTPException Invalid credentials on /api/v1/auth/login
2025-08-08 22:49:48,542 - app.main - INFO - POST /api/v1/auth/login • ip=127.0.0.1 • device_id=- • 401 • 227.8ms
2025-08-08 22:49:48,542 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 401 Unauthorized"
2025-08-08 22:49:48,631 - app.main - WARNING - HTTPException Invalid credentials on /api/v1/auth/login
2025-08-08 22:49:48,631 - app.main - INFO - POST /api/v1/auth/login • ip=127.0.0.1 • device_id=- • 401 • 9.5ms
2025-08-08 22:49:48,631 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 401 Unauthorized"
2025-08-08 22:49:48,687 - app.main - INFO - POST /api/v1/auth/login • ip=127.0.0.1 • device_id=- • 422 • 2.1ms
2025-08-08 22:49:48,688 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 422 Unprocessable Entity"
2025-08-08 22:49:48,991 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 250.1ms
2025-08-08 22:49:48,991 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:49,703 - app.utils.camera_tasks - ERROR - Processing error (/Users/saswatpandey/hydroleaf/.camdata_test/cam_test/raw/1.jpg)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/utils/camera_tasks.py", line 221, in encode_and_cleanup
    await _update_camera_stats(sess, cam, added_bytes=added_bytes, new_clip=started_new_clip)
  File "/Users/saswatpandey/hydroleaf/app/utils/camera_tasks.py", line 98, in _update_camera_stats
    cam.frames_received = (cam.frames_received or 0) + 1
                           ^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'frames_received'
2025-08-08 22:49:49,851 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8001/discovery "HTTP/1.1 200 OK"
2025-08-08 22:49:49,945 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8002/discovery "HTTP/1.1 200 OK"
2025-08-08 22:49:50,040 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8001/version "HTTP/1.1 200 OK"
2025-08-08 22:49:50,128 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8002/version "HTTP/1.1 200 OK"
2025-08-08 22:49:50,220 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8001/sensor "HTTP/1.1 200 OK"
2025-08-08 22:49:50,449 - httpx - INFO - HTTP Request: POST http://127.0.0.1:8001/pump "HTTP/1.1 200 OK"
2025-08-08 22:49:50,465 - httpx - INFO - HTTP Request: POST http://127.0.0.1:8001/dose_monitor "HTTP/1.1 200 OK"
2025-08-08 22:49:50,539 - httpx - INFO - HTTP Request: POST http://127.0.0.1:8001/pump_calibration "HTTP/1.1 200 OK"
2025-08-08 22:49:50,622 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8002/state "HTTP/1.1 200 OK"
2025-08-08 22:49:50,701 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8002/state "HTTP/1.1 200 OK"
2025-08-08 22:49:50,721 - httpx - INFO - HTTP Request: POST http://127.0.0.1:8002/toggle "HTTP/1.1 200 OK"
2025-08-08 22:49:50,722 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8002/state "HTTP/1.1 200 OK"
2025-08-08 22:49:50,941 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8003/state "HTTP/1.1 200 OK"
2025-08-08 22:49:51,034 - httpx - INFO - HTTP Request: POST http://127.0.0.1:8003/toggle "HTTP/1.1 200 OK"
2025-08-08 22:49:51,202 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8004/status "HTTP/1.1 200 OK"
2025-08-08 22:49:51,506 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 250.5ms
2025-08-08 22:49:51,506 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:51,523 - app.main - WARNING - HTTPException Invalid device token on /api/v1/device_comm/request
2025-08-08 22:49:51,523 - app.main - INFO - POST /api/v1/device_comm/request • ip=127.0.0.1 • device_id=- • 401 • 16.4ms
2025-08-08 22:49:51,523 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/device_comm/request "HTTP/1.1 401 Unauthorized"
2025-08-08 22:49:51,885 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 251.4ms
2025-08-08 22:49:51,885 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:51,901 - app.main - WARNING - HTTPException Invalid device token on /api/v1/device_comm/request
2025-08-08 22:49:51,901 - app.main - INFO - POST /api/v1/device_comm/request • ip=127.0.0.1 • device_id=- • 401 • 15.3ms
2025-08-08 22:49:51,901 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/device_comm/request "HTTP/1.1 401 Unauthorized"
2025-08-08 22:49:52,241 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 253.6ms
2025-08-08 22:49:52,241 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:52,255 - app.main - WARNING - HTTPException Invalid device token on /api/v1/device_comm/request
2025-08-08 22:49:52,255 - app.main - INFO - POST /api/v1/device_comm/request • ip=127.0.0.1 • device_id=- • 401 • 13.3ms
2025-08-08 22:49:52,255 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/device_comm/request "HTTP/1.1 401 Unauthorized"
2025-08-08 22:49:52,604 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 259.3ms
2025-08-08 22:49:52,604 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:52,616 - app.main - WARNING - HTTPException Invalid device token on /api/v1/device_comm/request
2025-08-08 22:49:52,617 - app.main - INFO - POST /api/v1/device_comm/request • ip=127.0.0.1 • device_id=- • 401 • 11.9ms
2025-08-08 22:49:52,617 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/device_comm/request "HTTP/1.1 401 Unauthorized"
2025-08-08 22:49:52,961 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 259.5ms
2025-08-08 22:49:52,962 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:52,974 - app.main - WARNING - HTTPException Invalid device token on /api/v1/device_comm/request
2025-08-08 22:49:52,974 - app.main - INFO - POST /api/v1/device_comm/request • ip=127.0.0.1 • device_id=- • 401 • 12.2ms
2025-08-08 22:49:52,974 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/device_comm/request "HTTP/1.1 401 Unauthorized"
2025-08-08 22:49:53,330 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 266.0ms
2025-08-08 22:49:53,330 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:53,348 - app.main - INFO - GET /api/v1/device_comm/device_state/valve-virtual • ip=127.0.0.1 • device_id=- • 204 • 17.4ms
2025-08-08 22:49:53,348 - httpx - INFO - HTTP Request: GET http://testserver/api/v1/device_comm/device_state/valve-virtual "HTTP/1.1 204 No Content"
2025-08-08 22:49:53,701 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 260.8ms
2025-08-08 22:49:53,701 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:53,714 - app.main - WARNING - HTTPException Invalid device token on /api/v1/device_comm/request
2025-08-08 22:49:53,714 - app.main - INFO - POST /api/v1/device_comm/request • ip=127.0.0.1 • device_id=- • 401 • 12.6ms
2025-08-08 22:49:53,714 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/device_comm/request "HTTP/1.1 401 Unauthorized"
2025-08-08 22:49:54,098 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 290.6ms
2025-08-08 22:49:54,099 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:54,111 - app.main - INFO - GET /api/v1/device_comm/device_state/switch-virtual • ip=127.0.0.1 • device_id=- • 204 • 11.4ms
2025-08-08 22:49:54,111 - httpx - INFO - HTTP Request: GET http://testserver/api/v1/device_comm/device_state/switch-virtual "HTTP/1.1 204 No Content"
2025-08-08 22:49:54,673 - httpx - INFO - HTTP Request: GET https://upload.wikimedia.org/wikipedia/commons/3/3f/Bacterial_spot_of_tomato_BC1.JPG "HTTP/1.1 404 Not Found"
2025-08-08 22:49:55,640 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 264.9ms
2025-08-08 22:49:55,640 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:49:55,657 - app.main - ERROR - Error on GET /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:49:55,663 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:49:59,054 - httpx - INFO - HTTP Request: GET https://google.serper.dev/search?q=optimal+growth+Please+consider+that+the+plant+%27TestPlant%27+is+being+grown+at+%27Berlin%27.&gl=in&hl=en&apiKey=eeaeee2729768c737ca5a6004968a9840677e523&num=5&full=true&output=detailed "HTTP/1.1 200 OK"
2025-08-08 22:49:59,355 - httpx - INFO - HTTP Request: GET https://www.mdpi.com/2037-0164/16/2/63 "HTTP/1.1 403 Forbidden"
2025-08-08 22:49:59,355 - app.services.serper - WARNING - HTTP error scraping https://www.mdpi.com/2037-0164/16/2/63: Client error '403 Forbidden' for url 'https://www.mdpi.com/2037-0164/16/2/63'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403
2025-08-08 22:49:59,368 - httpx - INFO - HTTP Request: GET https://www.researchgate.net/publication/353147638_Plant_growth_the_What_the_How_and_the_Why "HTTP/1.1 403 Forbidden"
2025-08-08 22:49:59,370 - httpx - INFO - HTTP Request: GET https://nph.onlinelibrary.wiley.com/doi/10.1111/nph.17610 "HTTP/1.1 403 Forbidden"
2025-08-08 22:49:59,372 - app.services.serper - WARNING - HTTP error scraping https://www.researchgate.net/publication/353147638_Plant_growth_the_What_the_How_and_the_Why: Client error '403 Forbidden' for url 'https://www.researchgate.net/publication/353147638_Plant_growth_the_What_the_How_and_the_Why'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403
2025-08-08 22:49:59,376 - app.services.serper - WARNING - HTTP error scraping https://nph.onlinelibrary.wiley.com/doi/10.1111/nph.17610: Client error '403 Forbidden' for url 'https://nph.onlinelibrary.wiley.com/doi/10.1111/nph.17610'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403
2025-08-08 22:49:59,525 - httpx - INFO - HTTP Request: GET https://academic.oup.com/aob/article/120/1/101/3861692 "HTTP/1.1 403 Forbidden"
2025-08-08 22:49:59,526 - app.services.serper - WARNING - HTTP error scraping https://academic.oup.com/aob/article/120/1/101/3861692: Client error '403 Forbidden' for url 'https://academic.oup.com/aob/article/120/1/101/3861692'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403
2025-08-08 22:49:59,665 - httpx - INFO - HTTP Request: GET https://pmc.ncbi.nlm.nih.gov/articles/PMC8912713/ "HTTP/1.1 403 Forbidden"
2025-08-08 22:49:59,667 - app.services.serper - WARNING - HTTP error scraping https://pmc.ncbi.nlm.nih.gov/articles/PMC8912713/: Client error '403 Forbidden' for url 'https://pmc.ncbi.nlm.nih.gov/articles/PMC8912713/'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/403
2025-08-08 22:49:59,879 - httpx - INFO - HTTP Request: GET http://127.0.0.1:11434/api/models "HTTP/1.1 404 Not Found"
2025-08-08 22:50:00,371 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 265.3ms
2025-08-08 22:50:00,372 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:00,372 - app.main - INFO - POST /admin/plans/ • ip=127.0.0.1 • device_id=- • 404 • 0.4ms
2025-08-08 22:50:00,373 - httpx - INFO - HTTP Request: POST http://testserver/admin/plans/ "HTTP/1.1 404 Not Found"
2025-08-08 22:50:00,744 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 261.2ms
2025-08-08 22:50:00,744 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:00,744 - app.main - INFO - POST /admin/plans/ • ip=127.0.0.1 • device_id=- • 404 • 0.2ms
2025-08-08 22:50:00,745 - httpx - INFO - HTTP Request: POST http://testserver/admin/plans/ "HTTP/1.1 404 Not Found"
2025-08-08 22:50:01,113 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 259.0ms
2025-08-08 22:50:01,114 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:01,114 - app.main - INFO - POST /admin/plans/ • ip=127.0.0.1 • device_id=- • 404 • 0.2ms
2025-08-08 22:50:01,114 - httpx - INFO - HTTP Request: POST http://testserver/admin/plans/ "HTTP/1.1 404 Not Found"
2025-08-08 22:50:01,481 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 259.6ms
2025-08-08 22:50:01,482 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:01,482 - app.main - INFO - POST /admin/plans/ • ip=127.0.0.1 • device_id=- • 404 • 0.2ms
2025-08-08 22:50:01,483 - httpx - INFO - HTTP Request: POST http://testserver/admin/plans/ "HTTP/1.1 404 Not Found"
2025-08-08 22:50:01,846 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 259.2ms
2025-08-08 22:50:01,847 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:01,847 - app.main - INFO - POST /admin/plans/ • ip=127.0.0.1 • device_id=- • 404 • 0.3ms
2025-08-08 22:50:01,848 - httpx - INFO - HTTP Request: POST http://testserver/admin/plans/ "HTTP/1.1 404 Not Found"
2025-08-08 22:50:02,222 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 262.9ms
2025-08-08 22:50:02,222 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:02,223 - app.main - INFO - POST /admin/plans/ • ip=127.0.0.1 • device_id=- • 404 • 0.2ms
2025-08-08 22:50:02,223 - httpx - INFO - HTTP Request: POST http://testserver/admin/plans/ "HTTP/1.1 404 Not Found"
2025-08-08 22:50:02,595 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 261.8ms
2025-08-08 22:50:02,596 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:02,608 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:02,608 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:03,109 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 259.5ms
2025-08-08 22:50:03,109 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:03,122 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:03,123 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:03,728 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 278.9ms
2025-08-08 22:50:03,728 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:03,740 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:03,741 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:04,264 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 267.3ms
2025-08-08 22:50:04,264 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:04,281 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:04,282 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:04,820 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 260.6ms
2025-08-08 22:50:04,820 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:04,836 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:04,837 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:05,339 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 279.2ms
2025-08-08 22:50:05,340 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:05,353 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:05,362 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:05,851 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 253.6ms
2025-08-08 22:50:05,851 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:05,862 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:05,863 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:06,335 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 256.1ms
2025-08-08 22:50:06,335 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:06,347 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:06,348 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:06,921 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 252.2ms
2025-08-08 22:50:06,921 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:06,936 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:06,937 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:07,428 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 254.5ms
2025-08-08 22:50:07,428 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:07,440 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:07,441 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:07,962 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 261.3ms
2025-08-08 22:50:07,963 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:07,976 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:07,977 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:08,452 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 257.0ms
2025-08-08 22:50:08,453 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:08,465 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:08,466 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:08,946 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 256.2ms
2025-08-08 22:50:08,946 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:08,964 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:08,965 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:09,444 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 259.5ms
2025-08-08 22:50:09,445 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:09,459 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:09,460 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:09,934 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 255.7ms
2025-08-08 22:50:09,934 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:09,946 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:09,946 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:10,389 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 247.5ms
2025-08-08 22:50:10,390 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:10,404 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:10,405 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:10,928 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 257.3ms
2025-08-08 22:50:10,928 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:10,942 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:10,943 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:11,408 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 253.7ms
2025-08-08 22:50:11,408 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:11,422 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:11,423 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:11,892 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 254.7ms
2025-08-08 22:50:11,893 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:11,908 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:11,909 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:12,392 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 259.2ms
2025-08-08 22:50:12,392 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:12,407 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:12,408 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:12,888 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 259.1ms
2025-08-08 22:50:12,888 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:12,902 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:12,903 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:13,373 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 254.1ms
2025-08-08 22:50:13,373 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:13,386 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:13,387 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:13,862 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 257.9ms
2025-08-08 22:50:13,862 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:13,872 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:13,873 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:14,397 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 264.2ms
2025-08-08 22:50:14,397 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:14,409 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:14,410 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:14,888 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 256.4ms
2025-08-08 22:50:14,888 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:14,903 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:14,904 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:15,355 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 243.3ms
2025-08-08 22:50:15,355 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:15,367 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:15,368 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:15,851 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 273.1ms
2025-08-08 22:50:15,853 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:15,912 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:15,913 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:16,423 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 282.0ms
2025-08-08 22:50:16,423 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:16,432 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:16,433 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:16,906 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 252.7ms
2025-08-08 22:50:16,907 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:16,922 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:16,923 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:17,407 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 245.8ms
2025-08-08 22:50:17,408 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:17,424 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:17,424 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:17,891 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 255.9ms
2025-08-08 22:50:17,891 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:17,903 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:17,904 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:18,388 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 256.9ms
2025-08-08 22:50:18,388 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:18,401 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:18,401 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:18,870 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 256.3ms
2025-08-08 22:50:18,870 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:18,883 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:18,884 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:19,354 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 252.9ms
2025-08-08 22:50:19,354 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:19,371 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:19,372 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:19,856 - app.services.plant_service - INFO - Fetching plants from database...
2025-08-08 22:50:19,856 - app.services.plant_service - INFO - No plants found, returning an empty list.
2025-08-08 22:50:20,256 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 279.3ms
2025-08-08 22:50:20,256 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:20,268 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:20,269 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:20,772 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 256.1ms
2025-08-08 22:50:20,773 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:20,786 - app.main - ERROR - Error on POST /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:20,787 - app.main - ERROR - Unhandled exception on /api/v1/farms/: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:22,294 - httpx - INFO - HTTP Request: GET https://google.serper.dev/search?q=hydroponics+india&gl=in&hl=en&apiKey=eeaeee2729768c737ca5a6004968a9840677e523&num=5&full=true&output=detailed "HTTP/1.1 200 OK"
2025-08-08 22:50:22,697 - httpx - INFO - HTTP Request: GET https://risehydroponics.in/ "HTTP/1.1 200 OK"
2025-08-08 22:50:22,761 - httpx - INFO - HTTP Request: GET https://www.investindia.gov.in/team-india-blogs/why-hydroponics-holds-key-sustainable-agriculture "HTTP/1.1 200 OK"
2025-08-08 22:50:23,030 - httpx - INFO - HTTP Request: GET https://briohydroponics.com/ "HTTP/1.1 301 Moved Permanently"
2025-08-08 22:50:23,031 - app.services.serper - WARNING - HTTP error scraping https://briohydroponics.com/: Redirect response '301 Moved Permanently' for url 'https://briohydroponics.com/'
Redirect location: 'https://www.briohydroponics.com/'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/301
2025-08-08 22:50:23,177 - httpx - INFO - HTTP Request: GET https://www.urbankisaan.com/ "HTTP/1.1 200 OK"
2025-08-08 22:50:24,289 - httpx - INFO - HTTP Request: GET https://enterclimate.com/blog/scope-of-hydroponic-farming-in-india/ "HTTP/1.1 200 OK"
2025-08-08 22:50:24,512 - app.main - INFO - POST /admin/plans/ • ip=127.0.0.1 • device_id=- • 404 • 0.5ms
2025-08-08 22:50:24,512 - httpx - INFO - HTTP Request: POST http://testserver/admin/plans/ "HTTP/1.1 404 Not Found"
2025-08-08 22:50:24,513 - app.main - INFO - PUT /admin/plans/00000000-0000-0000-0000-000000000001 • ip=127.0.0.1 • device_id=- • 404 • 0.3ms
2025-08-08 22:50:24,513 - httpx - INFO - HTTP Request: PUT http://testserver/admin/plans/00000000-0000-0000-0000-000000000001 "HTTP/1.1 404 Not Found"
2025-08-08 22:50:24,514 - app.main - INFO - DELETE /admin/plans/00000000-0000-0000-0000-000000000001 • ip=127.0.0.1 • device_id=- • 404 • 0.3ms
2025-08-08 22:50:24,514 - httpx - INFO - HTTP Request: DELETE http://testserver/admin/plans/00000000-0000-0000-0000-000000000001 "HTTP/1.1 404 Not Found"
2025-08-08 22:50:24,515 - app.main - INFO - POST /admin/payments/approve/00000000-0000-0000-0000-000000000001 • ip=127.0.0.1 • device_id=- • 404 • 0.3ms
2025-08-08 22:50:24,515 - httpx - INFO - HTTP Request: POST http://testserver/admin/payments/approve/00000000-0000-0000-0000-000000000001 "HTTP/1.1 404 Not Found"
2025-08-08 22:50:24,516 - app.main - INFO - POST /admin/payments/reject/00000000-0000-0000-0000-000000000001 • ip=127.0.0.1 • device_id=- • 404 • 0.3ms
2025-08-08 22:50:24,516 - httpx - INFO - HTTP Request: POST http://testserver/admin/payments/reject/00000000-0000-0000-0000-000000000001 "HTTP/1.1 404 Not Found"
2025-08-08 22:50:24,838 - app.main - INFO - POST /admin/plans/ • ip=127.0.0.1 • device_id=- • 404 • 0.6ms
2025-08-08 22:50:24,838 - httpx - INFO - HTTP Request: POST http://testserver/admin/plans/ "HTTP/1.1 404 Not Found"
2025-08-08 22:50:25,179 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 276.7ms
2025-08-08 22:50:25,180 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:25,516 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 259.2ms
2025-08-08 22:50:25,516 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:25,847 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 253.8ms
2025-08-08 22:50:25,847 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:26,186 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 249.0ms
2025-08-08 22:50:26,186 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:26,533 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 255.6ms
2025-08-08 22:50:26,533 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:26,877 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 254.1ms
2025-08-08 22:50:26,877 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:27,226 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 257.5ms
2025-08-08 22:50:27,226 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:27,956 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 284.3ms
2025-08-08 22:50:27,957 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:27,958 - app.main - INFO - POST /api/v1/supply-chain/extract • ip=127.0.0.1 • device_id=- • 404 • 0.3ms
2025-08-08 22:50:27,958 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/supply-chain/extract "HTTP/1.1 404 Not Found"
2025-08-08 22:50:28,311 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 258.1ms
2025-08-08 22:50:28,311 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:28,324 - app.main - ERROR - Error on POST /api/v1/devices/dosing: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:28,325 - app.main - ERROR - Unhandled exception on /api/v1/devices/dosing: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:28,902 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 271.0ms
2025-08-08 22:50:28,903 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:28,916 - app.main - ERROR - Error on POST /api/v1/devices/dosing: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:28,917 - app.main - ERROR - Unhandled exception on /api/v1/devices/dosing: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:29,396 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 256.8ms
2025-08-08 22:50:29,397 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:29,410 - app.main - ERROR - Error on POST /api/v1/devices/dosing: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:29,410 - app.main - ERROR - Unhandled exception on /api/v1/devices/dosing: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:29,948 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 267.0ms
2025-08-08 22:50:29,948 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:29,964 - app.main - ERROR - Error on POST /api/v1/devices/dosing: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:29,965 - app.main - ERROR - Unhandled exception on /api/v1/devices/dosing: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:30,536 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 272.3ms
2025-08-08 22:50:30,536 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:30,552 - app.main - ERROR - Error on POST /api/v1/devices/dosing: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:30,553 - app.main - ERROR - Unhandled exception on /api/v1/devices/dosing: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:30,771 - app.main - INFO - POST /admin/device/bf174ed9-bc65-412f-a5a5-1db3279797f4/issue-token • ip=127.0.0.1 • device_id=- • 404 • 0.3ms
2025-08-08 22:50:30,771 - httpx - INFO - HTTP Request: POST http://testserver/admin/device/bf174ed9-bc65-412f-a5a5-1db3279797f4/issue-token "HTTP/1.1 404 Not Found"
2025-08-08 22:50:31,106 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 201 • 260.1ms
2025-08-08 22:50:31,107 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-08 22:50:31,119 - app.main - ERROR - Error on GET /api/v1/users/me: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
2025-08-08 22:50:31,119 - app.main - ERROR - Unhandled exception on /api/v1/users/me: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    |     user = result.scalar_one_or_none()
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    |     return self._only_one_row(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    |     existing_row_hash = strategy(row) if strategy else row
    |                         ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    |     raise sa_exc.InvalidRequestError(
    | sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 98, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/dependencies.py", line 48, in get_current_user
    user = result.scalar_one_or_none()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 1485, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/result.py", line 776, in _only_one_row
    existing_row_hash = strategy(row) if strategy else row
                        ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/loading.py", line 285, in require_unique
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: The unique() method must be invoked on this Result, as it contains results that include joined eager loads against collections
