2025-07-31 21:55:41,632 - app.main - ERROR - Error on POST /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\_backends\_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 46, in signup
    existing = await db.execute(
               ^^^^^^^^^^^^^^^^^
        select(User).where(User.email == user_create.email)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 794, in _handle_exception
    raise error
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\_backends\_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-07-31 21:55:41,647 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\_backends\_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\useit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    |     resp = await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 46, in signup
    |     existing = await db.execute(
    |                ^^^^^^^^^^^^^^^^^
    |         select(User).where(User.email == user_create.email)
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    |     result = await greenlet_spawn(
    |              ^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    |     return self._execute_internal(
    |            ~~~~~~~~~~~~~~~~~~~~~~^
    |         statement,
    |         ^^^^^^^^^^
    |     ...<4 lines>...
    |         _add_event=_add_event,
    |         ^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    |     result: Result[Any] = compile_state_cls.orm_execute_statement(
    |                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
    |         self,
    |         ^^^^^
    |     ...<4 lines>...
    |         conn,
    |         ^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    |     result = conn.execute(
    |         statement, params or {}, execution_options=execution_options
    |     )
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    |     return meth(
    |         self,
    |         distilled_parameters,
    |         execution_options or NO_OPTIONS,
    |     )
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    |     return connection._execute_clauseelement(
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
    |         self, distilled_params, execution_options
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    |     ret = self._execute_context(
    |         dialect,
    |     ...<8 lines>...
    |         cache_hit=cache_hit,
    |     )
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    |     return self._exec_single_context(
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~^
    |         dialect, context, statement, parameters
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    |     self._handle_dbapi_exception(
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
    |         e, str_statement, effective_parameters, cursor, context
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    |     raise exc_info[1].with_traceback(exc_info[2])
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    |     self.dialect.do_execute(
    |     ~~~~~~~~~~~~~~~~~~~~~~~^
    |         cursor, str_statement, effective_parameters, context
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    |     cursor.execute(statement, parameters)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    |     self._adapt_connection.await_(
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
    |         self._prepare_and_execute(operation, parameters)
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    |     await adapt_connection._start_transaction()
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    |     self._handle_exception(error)
    |     ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 794, in _handle_exception
    |     raise error
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    |     await self._transaction.start()
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg\\protocol\\protocol.pyx", line 375, in query
    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\_backends\_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\useit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 46, in signup
    existing = await db.execute(
               ^^^^^^^^^^^^^^^^^
        select(User).where(User.email == user_create.email)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 794, in _handle_exception
    raise error
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\_backends\_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-07-31 21:55:42,781 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 2.4ms
2025-07-31 21:55:42,782 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-07-31 21:55:43,157 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 2.2ms
2025-07-31 21:55:43,158 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-07-31 21:55:43,503 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 2.6ms
2025-07-31 21:55:43,504 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-07-31 21:55:43,811 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 1.6ms
2025-07-31 21:55:43,812 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-07-31 21:55:44,142 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 1.3ms
2025-07-31 21:55:44,143 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-07-31 21:55:44,486 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 2.1ms
2025-07-31 21:55:44,487 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-07-31 21:55:44,899 - app.main - ERROR - Error on POST /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 360, in query
  File "asyncpg\\protocol\\protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 85, in login
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
        select(User).where(User.email == form_data.username)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-07-31 21:55:44,909 - app.main - ERROR - Unhandled exception on /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 360, in query
  File "asyncpg\\protocol\\protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\useit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 85, in login
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
        select(User).where(User.email == form_data.username)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-07-31 21:55:46,063 - app.main - INFO - POST /api/v1/auth/login • ip=127.0.0.1 • device_id=- • 422 • 4.4ms
2025-07-31 21:55:46,063 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 422 Unprocessable Entity"
2025-07-31 21:55:46,391 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 1.3ms
2025-07-31 21:55:46,391 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-07-31 22:04:24,688 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 404 • 0.3ms
2025-07-31 22:04:24,689 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 404 Not Found"
2025-07-31 22:04:25,029 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 404 • 0.2ms
2025-07-31 22:04:25,029 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 404 Not Found"
2025-07-31 22:04:25,240 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 404 • 0.2ms
2025-07-31 22:04:25,240 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 404 Not Found"
2025-07-31 22:04:25,455 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 404 • 0.2ms
2025-07-31 22:04:25,455 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 404 Not Found"
2025-07-31 22:04:25,694 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 404 • 0.2ms
2025-07-31 22:04:25,695 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 404 Not Found"
2025-07-31 22:04:25,933 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 404 • 0.2ms
2025-07-31 22:04:25,934 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 404 Not Found"
2025-07-31 22:04:26,135 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 404 • 0.2ms
2025-07-31 22:04:26,135 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 404 Not Found"
2025-07-31 22:04:26,363 - app.main - INFO - POST /api/v1/auth/login • ip=127.0.0.1 • device_id=- • 404 • 0.2ms
2025-07-31 22:04:26,364 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 404 Not Found"
2025-07-31 22:04:26,564 - app.main - INFO - POST /api/v1/auth/login • ip=127.0.0.1 • device_id=- • 404 • 0.3ms
2025-07-31 22:04:26,564 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 404 Not Found"
2025-07-31 22:04:26,770 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 404 • 0.2ms
2025-07-31 22:04:26,770 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 404 Not Found"
2025-07-31 22:05:44,480 - app.main - ERROR - Error on POST /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\_backends\_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "c:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 794, in _handle_exception
    raise error
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\_backends\_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-07-31 22:05:44,492 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\_backends\_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\useit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    |     resp = await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 83, in signup
    |     result = await db.execute(select(User).where(User.email == user_create.email))
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    |     result = await greenlet_spawn(
    |              ^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    |     return self._execute_internal(
    |            ~~~~~~~~~~~~~~~~~~~~~~^
    |         statement,
    |         ^^^^^^^^^^
    |     ...<4 lines>...
    |         _add_event=_add_event,
    |         ^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    |     result: Result[Any] = compile_state_cls.orm_execute_statement(
    |                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
    |         self,
    |         ^^^^^
    |     ...<4 lines>...
    |         conn,
    |         ^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    |     result = conn.execute(
    |         statement, params or {}, execution_options=execution_options
    |     )
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    |     return meth(
    |         self,
    |         distilled_parameters,
    |         execution_options or NO_OPTIONS,
    |     )
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    |     return connection._execute_clauseelement(
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
    |         self, distilled_params, execution_options
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    |     ret = self._execute_context(
    |         dialect,
    |     ...<8 lines>...
    |         cache_hit=cache_hit,
    |     )
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    |     return self._exec_single_context(
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~^
    |         dialect, context, statement, parameters
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    |     self._handle_dbapi_exception(
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
    |         e, str_statement, effective_parameters, cursor, context
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    |     raise exc_info[1].with_traceback(exc_info[2])
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    |     self.dialect.do_execute(
    |     ~~~~~~~~~~~~~~~~~~~~~~~^
    |         cursor, str_statement, effective_parameters, context
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    |     cursor.execute(statement, parameters)
    |     ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    |     self._adapt_connection.await_(
    |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
    |         self._prepare_and_execute(operation, parameters)
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    |     await adapt_connection._start_transaction()
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    |     self._handle_exception(error)
    |     ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 794, in _handle_exception
    |     raise error
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    |     await self._transaction.start()
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg\\protocol\\protocol.pyx", line 375, in query
    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\_backends\_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\useit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 794, in _handle_exception
    raise error
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\anyio\_backends\_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-07-31 22:05:45,320 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 360, in query
  File "asyncpg\\protocol\\protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-07-31 22:05:45,325 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 360, in query
  File "asyncpg\\protocol\\protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\useit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-07-31 22:05:46,134 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 1.7ms
2025-07-31 22:05:46,134 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-07-31 22:05:46,374 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 1.2ms
2025-07-31 22:05:46,375 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-07-31 22:05:46,660 - app.main - INFO - POST /api/v1/auth/signup • ip=127.0.0.1 • device_id=- • 422 • 0.9ms
2025-07-31 22:05:46,661 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-07-31 22:05:46,892 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 360, in query
  File "asyncpg\\protocol\\protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-07-31 22:05:46,896 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 360, in query
  File "asyncpg\\protocol\\protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\useit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-07-31 22:05:47,468 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 360, in query
  File "asyncpg\\protocol\\protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-07-31 22:05:47,472 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 360, in query
  File "asyncpg\\protocol\\protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\useit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-07-31 22:05:48,103 - app.main - ERROR - Error on POST /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 360, in query
  File "asyncpg\\protocol\\protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-07-31 22:05:48,107 - app.main - ERROR - Unhandled exception on /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 360, in query
  File "asyncpg\\protocol\\protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\useit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-07-31 22:05:48,742 - app.main - INFO - POST /api/v1/auth/login • ip=127.0.0.1 • device_id=- • 422 • 2.4ms
2025-07-31 22:05:48,743 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 422 Unprocessable Entity"
2025-07-31 22:05:48,975 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 360, in query
  File "asyncpg\\protocol\\protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-07-31 22:05:48,979 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 360, in query
  File "asyncpg\\protocol\\protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\useit\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\app\routers\auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\engine\default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\useit\Hydroleaf-Backend\hydroleaf\env\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 14:26:28,574 - app.main - ERROR - Error on POST /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    raise error
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-08-01 14:26:28,587 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    |     resp = await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    |     result = await db.execute(select(User).where(User.email == user_create.email))
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    |     result = await greenlet_spawn(
    |              ^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    |     return self._execute_internal(
    |            ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    |     result: Result[Any] = compile_state_cls.orm_execute_statement(
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    |     result = conn.execute(
    |              ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    |     return meth(
    |            ^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    |     return connection._execute_clauseelement(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    |     ret = self._execute_context(
    |           ^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    |     return self._exec_single_context(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    |     self._handle_dbapi_exception(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    |     raise exc_info[1].with_traceback(exc_info[2])
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    |     self.dialect.do_execute(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    |     cursor.execute(statement, parameters)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    |     self._adapt_connection.await_(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    |     await adapt_connection._start_transaction()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    |     self._handle_exception(error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    |     raise error
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    |     await self._transaction.start()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg/protocol/protocol.pyx", line 375, in query
    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    raise error
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-08-01 14:26:28,986 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 14:26:28,989 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 14:26:29,414 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.4ms
2025-08-01 14:26:29,414 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 14:26:29,493 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.9ms
2025-08-01 14:26:29,494 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 14:26:29,574 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.7ms
2025-08-01 14:26:29,574 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 14:26:29,658 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 14:26:29,662 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 14:26:30,051 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 14:26:30,053 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 14:26:30,445 - app.main - ERROR - Error on POST /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 14:26:30,448 - app.main - ERROR - Unhandled exception on /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 14:26:30,829 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 3.1ms
2025-08-01 14:26:30,829 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 14:26:30,916 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 14:26:30,918 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:22:08,994 - app.main - ERROR - Error on POST /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    raise error
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-08-01 15:22:09,007 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    |     resp = await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    |     result = await db.execute(select(User).where(User.email == user_create.email))
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    |     result = await greenlet_spawn(
    |              ^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    |     return self._execute_internal(
    |            ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    |     result: Result[Any] = compile_state_cls.orm_execute_statement(
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    |     result = conn.execute(
    |              ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    |     return meth(
    |            ^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    |     return connection._execute_clauseelement(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    |     ret = self._execute_context(
    |           ^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    |     return self._exec_single_context(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    |     self._handle_dbapi_exception(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    |     raise exc_info[1].with_traceback(exc_info[2])
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    |     self.dialect.do_execute(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    |     cursor.execute(statement, parameters)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    |     self._adapt_connection.await_(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    |     await adapt_connection._start_transaction()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    |     self._handle_exception(error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    |     raise error
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    |     await self._transaction.start()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg/protocol/protocol.pyx", line 375, in query
    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    raise error
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-08-01 15:22:09,490 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:22:09,493 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:22:09,948 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.1ms
2025-08-01 15:22:09,948 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:22:10,023 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.1ms
2025-08-01 15:22:10,024 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:22:10,143 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.1ms
2025-08-01 15:22:10,143 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:22:10,223 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:22:10,225 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:22:10,606 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:22:10,608 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:22:10,966 - app.main - ERROR - Error on POST /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:22:10,968 - app.main - ERROR - Unhandled exception on /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:22:11,317 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 2.3ms
2025-08-01 15:22:11,318 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:22:11,390 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:22:11,393 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:23:27,534 - uvicorn.error - INFO - Started server process [65419]
2025-08-01 15:23:27,535 - uvicorn.error - INFO - Waiting for application startup.
2025-08-01 15:23:27,535 - uvicorn.error - INFO - Application startup complete.
2025-08-01 15:23:27,536 - uvicorn.error - INFO - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2025-08-01 15:23:32,606 - app.main - INFO - GET /docs â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 404 â€¢ 1.9ms
2025-08-01 15:23:32,732 - app.main - INFO - GET /favicon.ico â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 404 â€¢ 0.5ms
2025-08-01 15:23:39,427 - app.main - INFO - GET /api/v1/docs â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 200 â€¢ 0.9ms
2025-08-01 15:23:39,817 - app.main - INFO - GET /api/v1/openapi.json â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 200 â€¢ 18.8ms
2025-08-01 15:23:46,878 - app.main - ERROR - Error on POST /api/v1/auth/signup: bcrypt: no backends available -- recommend you install one (e.g. 'pip install bcrypt')
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 91, in signup
    hashed_pw = get_password_hash(user_create.password)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 33, in get_password_hash
    return pwd_context.hash(password)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/context.py", line 2258, in hash
    return record.hash(secret, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 779, in hash
    self.checksum = self._calc_checksum(secret)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 591, in _calc_checksum
    self._stub_requires_backend()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2254, in _stub_requires_backend
    cls.set_backend()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2156, in set_backend
    return owner.set_backend(name, dryrun=dryrun)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2176, in set_backend
    raise default_error
passlib.exc.MissingBackendError: bcrypt: no backends available -- recommend you install one (e.g. 'pip install bcrypt')
2025-08-01 15:23:46,885 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: bcrypt: no backends available -- recommend you install one (e.g. 'pip install bcrypt')
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    |     resp = await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 91, in signup
    |     hashed_pw = get_password_hash(user_create.password)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 33, in get_password_hash
    |     return pwd_context.hash(password)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/context.py", line 2258, in hash
    |     return record.hash(secret, **kwds)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 779, in hash
    |     self.checksum = self._calc_checksum(secret)
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 591, in _calc_checksum
    |     self._stub_requires_backend()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2254, in _stub_requires_backend
    |     cls.set_backend()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2156, in set_backend
    |     return owner.set_backend(name, dryrun=dryrun)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2176, in set_backend
    |     raise default_error
    | passlib.exc.MissingBackendError: bcrypt: no backends available -- recommend you install one (e.g. 'pip install bcrypt')
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 91, in signup
    hashed_pw = get_password_hash(user_create.password)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 33, in get_password_hash
    return pwd_context.hash(password)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/context.py", line 2258, in hash
    return record.hash(secret, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 779, in hash
    self.checksum = self._calc_checksum(secret)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 591, in _calc_checksum
    self._stub_requires_backend()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2254, in _stub_requires_backend
    cls.set_backend()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2156, in set_backend
    return owner.set_backend(name, dryrun=dryrun)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2176, in set_backend
    raise default_error
passlib.exc.MissingBackendError: bcrypt: no backends available -- recommend you install one (e.g. 'pip install bcrypt')
2025-08-01 15:23:46,890 - uvicorn.error - ERROR - Exception in ASGI application
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    |     result = await app(  # type: ignore[func-returns-value]
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    |     return await self.app(scope, receive, send)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    |     resp = await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 91, in signup
    |     hashed_pw = get_password_hash(user_create.password)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 33, in get_password_hash
    |     return pwd_context.hash(password)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/context.py", line 2258, in hash
    |     return record.hash(secret, **kwds)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 779, in hash
    |     self.checksum = self._calc_checksum(secret)
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 591, in _calc_checksum
    |     self._stub_requires_backend()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2254, in _stub_requires_backend
    |     cls.set_backend()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2156, in set_backend
    |     return owner.set_backend(name, dryrun=dryrun)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2176, in set_backend
    |     raise default_error
    | passlib.exc.MissingBackendError: bcrypt: no backends available -- recommend you install one (e.g. 'pip install bcrypt')
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 91, in signup
    hashed_pw = get_password_hash(user_create.password)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 33, in get_password_hash
    return pwd_context.hash(password)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/context.py", line 2258, in hash
    return record.hash(secret, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 779, in hash
    self.checksum = self._calc_checksum(secret)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 591, in _calc_checksum
    self._stub_requires_backend()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2254, in _stub_requires_backend
    cls.set_backend()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2156, in set_backend
    return owner.set_backend(name, dryrun=dryrun)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/utils/handlers.py", line 2176, in set_backend
    raise default_error
passlib.exc.MissingBackendError: bcrypt: no backends available -- recommend you install one (e.g. 'pip install bcrypt')
2025-08-01 15:23:58,293 - uvicorn.error - INFO - Shutting down
2025-08-01 15:23:58,397 - uvicorn.error - INFO - Waiting for application shutdown.
2025-08-01 15:23:58,399 - uvicorn.error - INFO - Application shutdown complete.
2025-08-01 15:23:58,400 - uvicorn.error - INFO - Finished server process [65419]
2025-08-01 15:24:05,473 - uvicorn.error - INFO - Started server process [65617]
2025-08-01 15:24:05,474 - uvicorn.error - INFO - Waiting for application startup.
2025-08-01 15:24:05,474 - uvicorn.error - INFO - Application startup complete.
2025-08-01 15:24:05,474 - uvicorn.error - INFO - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2025-08-01 15:24:11,437 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-01 15:24:11,704 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 335.9ms
2025-08-01 15:24:51,547 - app.main - WARNING - HTTPException Invalid credentials on /api/v1/auth/login
2025-08-01 15:24:51,548 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 401 â€¢ 12.9ms
2025-08-01 15:24:53,980 - app.main - WARNING - HTTPException Invalid credentials on /api/v1/auth/login
2025-08-01 15:24:53,980 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 401 â€¢ 4.6ms
2025-08-01 15:25:28,570 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 200 â€¢ 266.4ms
2025-08-01 15:29:38,718 - uvicorn.error - INFO - Shutting down
2025-08-01 15:29:38,827 - uvicorn.error - INFO - Waiting for application shutdown.
2025-08-01 15:29:38,831 - uvicorn.error - INFO - Application shutdown complete.
2025-08-01 15:29:38,832 - uvicorn.error - INFO - Finished server process [65617]
2025-08-01 15:29:43,599 - uvicorn.error - INFO - Started server process [65913]
2025-08-01 15:29:43,599 - uvicorn.error - INFO - Waiting for application startup.
2025-08-01 15:29:43,600 - uvicorn.error - INFO - Application startup complete.
2025-08-01 15:29:43,600 - uvicorn.error - INFO - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2025-08-01 15:29:48,329 - app.main - INFO - GET /api/v1/docs â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 200 â€¢ 0.4ms
2025-08-01 15:29:48,447 - app.main - INFO - GET /api/v1/openapi.json â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 200 â€¢ 17.5ms
2025-08-01 15:30:46,587 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-01 15:30:46,844 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 200 â€¢ 324.7ms
2025-08-01 15:32:58,184 - uvicorn.error - INFO - Shutting down
2025-08-01 15:32:58,295 - uvicorn.error - INFO - Waiting for application shutdown.
2025-08-01 15:32:58,299 - uvicorn.error - INFO - Application shutdown complete.
2025-08-01 15:32:58,300 - uvicorn.error - INFO - Finished server process [65913]
2025-08-01 15:33:03,647 - uvicorn.error - INFO - Started server process [66164]
2025-08-01 15:33:03,647 - uvicorn.error - INFO - Waiting for application startup.
2025-08-01 15:33:03,647 - uvicorn.error - INFO - Application startup complete.
2025-08-01 15:33:03,648 - uvicorn.error - INFO - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2025-08-01 15:43:48,479 - app.main - ERROR - Error on POST /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    raise error
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-08-01 15:43:48,494 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    |     resp = await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    |     result = await db.execute(select(User).where(User.email == user_create.email))
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    |     result = await greenlet_spawn(
    |              ^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    |     return self._execute_internal(
    |            ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    |     result: Result[Any] = compile_state_cls.orm_execute_statement(
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    |     result = conn.execute(
    |              ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    |     return meth(
    |            ^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    |     return connection._execute_clauseelement(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    |     ret = self._execute_context(
    |           ^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    |     return self._exec_single_context(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    |     self._handle_dbapi_exception(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    |     raise exc_info[1].with_traceback(exc_info[2])
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    |     self.dialect.do_execute(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    |     cursor.execute(statement, parameters)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    |     self._adapt_connection.await_(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    |     await adapt_connection._start_transaction()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    |     self._handle_exception(error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    |     raise error
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    |     await self._transaction.start()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg/protocol/protocol.pyx", line 375, in query
    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    raise error
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-08-01 15:43:48,985 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:43:48,988 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:43:49,342 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:43:49,344 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:43:49,694 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.9ms
2025-08-01 15:43:49,695 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:43:49,758 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.1ms
2025-08-01 15:43:49,759 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:43:49,821 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.3ms
2025-08-01 15:43:49,821 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:43:49,885 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:43:49,888 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:43:50,262 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:43:50,264 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:43:50,634 - app.main - ERROR - Error on POST /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:43:50,636 - app.main - ERROR - Unhandled exception on /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:43:51,037 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 2.3ms
2025-08-01 15:43:51,037 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:43:51,117 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:43:51,119 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:45:42,894 - app.main - ERROR - Error on POST /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    raise error
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-08-01 15:45:42,907 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    |     resp = await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    |     result = await db.execute(select(User).where(User.email == user_create.email))
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    |     result = await greenlet_spawn(
    |              ^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    |     return self._execute_internal(
    |            ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    |     result: Result[Any] = compile_state_cls.orm_execute_statement(
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    |     result = conn.execute(
    |              ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    |     return meth(
    |            ^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    |     return connection._execute_clauseelement(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    |     ret = self._execute_context(
    |           ^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    |     return self._exec_single_context(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    |     self._handle_dbapi_exception(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    |     raise exc_info[1].with_traceback(exc_info[2])
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    |     self.dialect.do_execute(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    |     cursor.execute(statement, parameters)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    |     self._adapt_connection.await_(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    |     await adapt_connection._start_transaction()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    |     self._handle_exception(error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    |     raise error
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    |     await self._transaction.start()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg/protocol/protocol.pyx", line 375, in query
    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    raise error
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-08-01 15:45:43,302 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:45:43,304 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:45:43,712 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:45:43,714 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:45:44,073 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 0.9ms
2025-08-01 15:45:44,074 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:45:44,135 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.4ms
2025-08-01 15:45:44,136 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:45:44,199 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.4ms
2025-08-01 15:45:44,199 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:45:44,300 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:45:44,302 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:45:44,663 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:45:44,665 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:45:45,027 - app.main - ERROR - Error on POST /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:45:45,029 - app.main - ERROR - Unhandled exception on /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:45:45,470 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 2.1ms
2025-08-01 15:45:45,470 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:45:45,539 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:45:45,542 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 75, in log_requests
    resp = await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:16,844 - app.main - ERROR - Error on POST /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    raise error
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-08-01 15:56:16,859 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    |     result = await db.execute(select(User).where(User.email == user_create.email))
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    |     result = await greenlet_spawn(
    |              ^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    |     return self._execute_internal(
    |            ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    |     result: Result[Any] = compile_state_cls.orm_execute_statement(
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    |     result = conn.execute(
    |              ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    |     return meth(
    |            ^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    |     return connection._execute_clauseelement(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    |     ret = self._execute_context(
    |           ^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    |     return self._exec_single_context(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    |     self._handle_dbapi_exception(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    |     raise exc_info[1].with_traceback(exc_info[2])
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    |     self.dialect.do_execute(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    |     cursor.execute(statement, parameters)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    |     self._adapt_connection.await_(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    |     await adapt_connection._start_transaction()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    |     self._handle_exception(error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    |     raise error
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    |     await self._transaction.start()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg/protocol/protocol.pyx", line 375, in query
    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    raise error
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-08-01 15:56:17,258 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:17,260 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:17,661 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:17,663 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:18,019 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 0.9ms
2025-08-01 15:56:18,020 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:56:18,084 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.5ms
2025-08-01 15:56:18,084 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:56:18,143 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.4ms
2025-08-01 15:56:18,144 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:56:18,213 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:18,217 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:18,596 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:18,598 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:18,938 - app.main - ERROR - Error on POST /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:18,940 - app.main - ERROR - Unhandled exception on /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:19,372 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 2.3ms
2025-08-01 15:56:19,372 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:56:19,444 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:19,446 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:29,781 - app.main - ERROR - Error on POST /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 147, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/streams/memory.py", line 126, in receive
    raise EndOfStream from None
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    raise error
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-08-01 15:56:29,794 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
  + Exception Group Traceback (most recent call last):
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    |     raise app_exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    |     await self.app(scope, receive, send_wrapper)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    |     result = await db.execute(select(User).where(User.email == user_create.email))
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    |     result = await greenlet_spawn(
    |              ^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    |     return self._execute_internal(
    |            ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    |     result: Result[Any] = compile_state_cls.orm_execute_statement(
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    |     result = conn.execute(
    |              ^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    |     return meth(
    |            ^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    |     return connection._execute_clauseelement(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    |     ret = self._execute_context(
    |           ^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    |     return self._exec_single_context(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    |     self._handle_dbapi_exception(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    |     raise exc_info[1].with_traceback(exc_info[2])
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    |     self.dialect.do_execute(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    |     cursor.execute(statement, parameters)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    |     self._adapt_connection.await_(
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    |     await adapt_connection._start_transaction()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    |     self._handle_exception(error)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    |     raise error
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    |     await self._transaction.start()
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg/protocol/protocol.pyx", line 375, in query
    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 794, in _handle_exception
    raise error
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 375, in query
RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py:140> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:794]> got Future <Future pending cb=[BaseProtocol._on_waiter_completed()]> attached to a different loop
2025-08-01 15:56:30,130 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:30,132 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('noprof@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:30,548 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:30,551 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:30,908 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 0.9ms
2025-08-01 15:56:30,908 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:56:30,969 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.4ms
2025-08-01 15:56:30,970 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:56:31,032 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.6ms
2025-08-01 15:56:31,032 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:56:31,107 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:31,110 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:31,501 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:31,503 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:31,884 - app.main - ERROR - Error on POST /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:31,886 - app.main - ERROR - Unhandled exception on /api/v1/auth/login: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 42, in login
    result = await db.execute(select(User).where(User.email == form_data.username))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('nouser@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:32,356 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 2.8ms
2025-08-01 15:56:32,356 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:56:32,427 - app.main - ERROR - Error on POST /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:56:32,430 - app.main - ERROR - Unhandled exception on /api/v1/auth/signup: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 843, in _start_transaction
    await self._transaction.start()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/transaction.py", line 146, in start
    await self._connection.execute(query)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/asyncpg/connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 360, in query
  File "asyncpg/protocol/protocol.pyx", line 745, in asyncpg.protocol.protocol.BaseProtocol._check_state
asyncpg.exceptions._base.InterfaceError: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.InterfaceError: <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/anaconda3/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_utils.py", line 82, in collapse_excgroups
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/main.py", line 91, in log_requests
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/fastapi/routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/app/routers/auth.py", line 83, in signup
    result = await db.execute(select(User).where(User.email == user_create.email))
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 515, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 845, in _start_transaction
    self._handle_exception(error)
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.InterfaceError: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: cannot perform operation: another operation is in progress
[SQL: SELECT users.id, users.email, users.hashed_password, users.role, users.created_at, users.updated_at, user_profiles_1.id AS id_1, user_profiles_1.user_id, user_profiles_1.first_name, user_profiles_1.last_name, user_profiles_1.phone, user_profiles_1.address, user_profiles_1.city, user_profiles_1.state, user_profiles_1.country, user_profiles_1.postal_code, user_profiles_1.created_at AS created_at_1, user_profiles_1.updated_at AS updated_at_1, farms_1.id AS id_2, farms_1.user_id AS user_id_1, farms_1.name, farms_1.location, farms_1.created_at AS created_at_2, farms_1.updated_at AS updated_at_2 
FROM users LEFT OUTER JOIN user_profiles AS user_profiles_1 ON users.id = user_profiles_1.user_id LEFT OUTER JOIN farms AS farms_1 ON users.id = farms_1.user_id 
WHERE users.email = $1::VARCHAR]
[parameters: ('user@example.com',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-08-01 15:58:10,060 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-01 15:58:10,334 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 321.4ms
2025-08-01 15:58:10,335 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 15:58:10,750 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 266.2ms
2025-08-01 15:58:10,751 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 15:58:11,125 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 260.9ms
2025-08-01 15:58:11,125 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 15:58:11,137 - app.main - WARNING - HTTPException Email already registered on /api/v1/auth/signup
2025-08-01 15:58:11,137 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 400 â€¢ 11.8ms
2025-08-01 15:58:11,137 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2025-08-01 15:58:11,259 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.1ms
2025-08-01 15:58:11,259 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:58:11,345 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.8ms
2025-08-01 15:58:11,346 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:58:11,458 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 0.8ms
2025-08-01 15:58:11,459 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:58:11,789 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 260.3ms
2025-08-01 15:58:11,789 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 15:58:12,022 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 200 â€¢ 232.1ms
2025-08-01 15:58:12,022 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 200 OK"
2025-08-01 15:58:12,379 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 252.2ms
2025-08-01 15:58:12,380 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 15:58:12,610 - app.main - WARNING - HTTPException Invalid credentials on /api/v1/auth/login
2025-08-01 15:58:12,610 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 401 â€¢ 229.6ms
2025-08-01 15:58:12,610 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 401 Unauthorized"
2025-08-01 15:58:12,729 - app.main - WARNING - HTTPException Invalid credentials on /api/v1/auth/login
2025-08-01 15:58:12,730 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 401 â€¢ 10.1ms
2025-08-01 15:58:12,730 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 401 Unauthorized"
2025-08-01 15:58:12,814 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 3.5ms
2025-08-01 15:58:12,814 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 15:58:13,173 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 276.3ms
2025-08-01 15:58:13,174 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:07:33,270 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-01 16:07:33,545 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 321.3ms
2025-08-01 16:07:33,545 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:07:33,986 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 267.8ms
2025-08-01 16:07:33,986 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:07:34,342 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 256.9ms
2025-08-01 16:07:34,342 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:07:34,356 - app.main - WARNING - HTTPException Email already registered on /api/v1/auth/signup
2025-08-01 16:07:34,356 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 400 â€¢ 13.2ms
2025-08-01 16:07:34,356 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2025-08-01 16:07:34,444 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.9ms
2025-08-01 16:07:34,444 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:07:34,508 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.6ms
2025-08-01 16:07:34,509 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:07:34,572 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.8ms
2025-08-01 16:07:34,573 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:07:34,934 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 250.1ms
2025-08-01 16:07:34,934 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:07:35,165 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 200 â€¢ 230.6ms
2025-08-01 16:07:35,165 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 200 OK"
2025-08-01 16:07:35,534 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 258.4ms
2025-08-01 16:07:35,535 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:07:35,766 - app.main - WARNING - HTTPException Invalid credentials on /api/v1/auth/login
2025-08-01 16:07:35,767 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 401 â€¢ 231.5ms
2025-08-01 16:07:35,767 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 401 Unauthorized"
2025-08-01 16:07:35,887 - app.main - WARNING - HTTPException Invalid credentials on /api/v1/auth/login
2025-08-01 16:07:35,887 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 401 â€¢ 10.2ms
2025-08-01 16:07:35,888 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 401 Unauthorized"
2025-08-01 16:07:35,961 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 3.4ms
2025-08-01 16:07:35,961 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:07:36,304 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 271.9ms
2025-08-01 16:07:36,304 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:08:05,476 - passlib.handlers.bcrypt - WARNING - (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/Users/saswatpandey/hydroleaf/env/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-01 16:08:05,736 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 299.9ms
2025-08-01 16:08:05,736 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:08:06,118 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 259.1ms
2025-08-01 16:08:06,119 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:08:06,467 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 258.9ms
2025-08-01 16:08:06,468 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:08:06,483 - app.main - WARNING - HTTPException Email already registered on /api/v1/auth/signup
2025-08-01 16:08:06,484 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 400 â€¢ 15.4ms
2025-08-01 16:08:06,484 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 400 Bad Request"
2025-08-01 16:08:06,586 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.0ms
2025-08-01 16:08:06,586 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:08:06,665 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.2ms
2025-08-01 16:08:06,665 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:08:06,737 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.2ms
2025-08-01 16:08:06,737 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:08:07,095 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 251.1ms
2025-08-01 16:08:07,095 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:08:07,330 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 200 â€¢ 234.5ms
2025-08-01 16:08:07,330 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 200 OK"
2025-08-01 16:08:07,701 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 259.0ms
2025-08-01 16:08:07,701 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:08:07,934 - app.main - WARNING - HTTPException Invalid credentials on /api/v1/auth/login
2025-08-01 16:08:07,934 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 401 â€¢ 232.1ms
2025-08-01 16:08:07,934 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 401 Unauthorized"
2025-08-01 16:08:08,053 - app.main - WARNING - HTTPException Invalid credentials on /api/v1/auth/login
2025-08-01 16:08:08,054 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 401 â€¢ 10.8ms
2025-08-01 16:08:08,054 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 401 Unauthorized"
2025-08-01 16:08:08,121 - app.main - INFO - POST /api/v1/auth/login â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 2.6ms
2025-08-01 16:08:08,121 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/login "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:08:08,469 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 201 â€¢ 268.4ms
2025-08-01 16:08:08,469 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 201 Created"
2025-08-01 16:08:09,261 - app.services.supply_chain_service - ERROR - No valid JSON block found in LLM response.
2025-08-01 16:08:09,840 - app.services.llm - INFO - Sending prompt to LLM:

2025-08-01 16:08:09,840 - app.services.llm - INFO - Ollama â†’ deepseek-r1:1.5b prompt:

2025-08-01 16:08:11,042 - app.services.dose_manager - INFO - Cancellation response for device devX: {'cancelled': True}
2025-08-01 16:08:11,514 - app.services.llm - ERROR - No valid JSON block found in OpenAI response: no braces at all
2025-08-01 16:08:14,025 - httpx - INFO - HTTP Request: GET https://google.serper.dev/search?q=optimal+growth.+Focus+on+best+practices+in+Europe+for+Veggie+cultivation.&gl=in&hl=en&apiKey=eeaeee2729768c737ca5a6004968a9840677e523&num=5&full=true&output=detailed "HTTP/1.1 200 OK"
2025-08-01 16:08:14,450 - httpx - INFO - HTTP Request: GET https://www.researchgate.net/publication/323363546_Strategies_for_optimal_fertiliser_management_of_vegetable_crops_in_Europe "HTTP/1.1 403 Forbidden"
2025-08-01 16:08:14,462 - httpx - INFO - HTTP Request: GET https://www.researchgate.net/publication/260984593_Good_Agricultural_Practices_for_greenhouse_vegetable_crops_Principles_for_Mediterranean_climate_areas "HTTP/1.1 403 Forbidden"
2025-08-01 16:08:14,463 - app.services.serper - WARNING - Scrape forbidden (403) for https://www.researchgate.net/publication/323363546_Strategies_for_optimal_fertiliser_management_of_vegetable_crops_in_Europe
2025-08-01 16:08:14,468 - app.services.serper - WARNING - Scrape forbidden (403) for https://www.researchgate.net/publication/260984593_Good_Agricultural_Practices_for_greenhouse_vegetable_crops_Principles_for_Mediterranean_climate_areas
2025-08-01 16:08:14,780 - httpx - INFO - HTTP Request: GET https://www.fao.org/4/i3284e/i3284e.pdf "HTTP/1.1 200 OK"
2025-08-01 16:08:15,396 - httpx - INFO - HTTP Request: GET https://agriculture.ec.europa.eu/system/files/2019-03/final-report-etop-greenhouse-production_0.pdf "HTTP/1.1 200 OK"
2025-08-01 16:08:15,621 - httpx - INFO - HTTP Request: GET https://www.agronomyjournals.com/article/view/2394/8-1-44 "HTTP/1.1 302 Moved Temporarily"
2025-08-01 16:08:15,623 - app.services.serper - WARNING - HTTP error scraping https://www.agronomyjournals.com/article/view/2394/8-1-44: Redirect response '302 Moved Temporarily' for url 'https://www.agronomyjournals.com/article/view/2394/8-1-44'
Redirect location: 'https://www.agronomyjournals.com/archives/2025/vol8issue1/PartD/8-1-44-621.pdf'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/302
2025-08-01 16:08:17,062 - app.services.plant_service - INFO - Fetching plants from database...
2025-08-01 16:08:17,062 - app.services.plant_service - INFO - No plants found, returning an empty list.
2025-08-01 16:08:17,118 - app.services.plant_service - INFO - Fetching plants from database...
2025-08-01 16:08:17,118 - app.services.plant_service - INFO - Fetched 2 plants from the database
2025-08-01 16:08:17,412 - app.services.plant_service - INFO - Fetching plants from database...
2025-08-01 16:08:17,412 - app.services.plant_service - ERROR - Database query failed: db is down
2025-08-01 16:08:17,503 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.9ms
2025-08-01 16:08:17,504 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:08:17,582 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.1ms
2025-08-01 16:08:17,582 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:08:17,646 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.4ms
2025-08-01 16:08:17,646 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:08:17,711 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.2ms
2025-08-01 16:08:17,712 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:08:17,771 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.2ms
2025-08-01 16:08:17,771 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:08:17,894 - app.main - INFO - POST /api/v1/auth/signup â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 422 â€¢ 1.7ms
2025-08-01 16:08:17,894 - httpx - INFO - HTTP Request: POST http://testserver/api/v1/auth/signup "HTTP/1.1 422 Unprocessable Entity"
2025-08-01 16:08:18,326 - app.main - INFO - POST /admin/device/dev-2/issue-token â€¢ ip=127.0.0.1 â€¢ device_id=- â€¢ 404 â€¢ 0.2ms
2025-08-01 16:08:18,326 - httpx - INFO - HTTP Request: POST http://test/admin/device/dev-2/issue-token "HTTP/1.1 404 Not Found"
